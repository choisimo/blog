---
title: "Proxmox Storage 1"
date: "2026-01-15"
category: "proxmox"
tags: ["proxmox", "태그2", "태그3"]
excerpt: "게시글 요약을 작성하세요"
readTime: "5분"
---

Proxmox 스토리지 유랑기: 파일과 블록, 그리고 ZFS의 깊은 숲에서 길을 찾다

1. 프롤로그: 선택의 갈림길에 서서

1.1. 도입: 모든 시작은 막막함으로부터

Proxmox의 세계에 처음 발을 들였을 때, 저를 맞이한 것은 가능성의 설렘보다는 선택지의 막막함이었습니다. 수많은 스토리지 옵션들이 눈앞에 펼쳐져 있었고, 각각의 이름은 낯설기만 했습니다. 이 복잡한 갈림길 앞에서 스토리지 설계란 단순히 '파일을 저장할 공간을 마련하는 것' 이상의 무게를 지닌, 앞으로의 모든 여정을 결정짓는 첫 번째 이정표임을 직감했습니다. 어떤 길을 택하느냐에 따라 시스템의 성능과 안정성, 그리고 관리의 편의성이 송두리째 달라질 수 있기에, 첫걸음은 신중해야만 했습니다.

가장 먼저 마주한 거대한 갈림길은 '파일 레벨'과 '블록 레벨'이라는 두 가지 방식이었습니다. 처음에는 그 차이가 모호하게만 느껴졌습니다. 하지만 곧 깨달았습니다. 이는 마치 지도 위에 목적지를 하나의 점(vm-100-disk-0.qcow2와 같은 이미지 파일)으로 찍어두는 것과, 아예 땅을 구획별(/dev/vg-data/vm-101-disk 같은 블록 디바이스)로 나누어 소유권을 정하는 것만큼이나 근본적인 차이라는 것을요. 전자는 간편하고 이해하기 쉬웠지만 어딘가 모를 오버헤드가 있을 것 같았고, 후자는 더 나은 성능을 약속하는 듯했지만 그만큼 복잡하고 까다로워 보였습니다. 어느 길이 정답일까, 간단함과 성능 사이에서 저의 고민은 깊어만 갔습니다.

이 막막함과 고뇌의 시간을 지나, 저는 결심했습니다. 이 낯선 용어들 뒤에 숨겨진 원리를 이해하고, 각자의 길이 가진 장점과 단점을 직접 걸어보며 체득하기로 말입니다. 그렇게 저의 길고 긴 스토리지 유랑은 시작되었습니다.

2. 본문: 각자의 길을 걷다

2.1. 가장 익숙한 길: Directory 스토리지

모든 여정의 시작은 가장 익숙하고 편안한 길에서 시작하는 것이 좋습니다. 저에게 Proxmox 스토리지의 첫걸음은 'Directory' 방식이었습니다. 리눅스 시스템을 다루어 본 사람이라면 누구나 이해할 수 있는, 지정된 폴더에 가상머신의 디스크 파일을 저장하는 이 방식은 복잡한 스토리지 세계에 입문하는 초심자에게 더할 나위 없이 좋은 출발점이었습니다.

이 길 위에서 저는 새로운 선택지를 만났습니다. raw, qcow2, vmdk라는 세 가지 이미지 포맷이었습니다. 성능이 전부라면 디스크 공간을 있는 그대로 모두 사용하는 raw를 선택해야 했고, 유연함과 안정성이 중요하다면 qcow2를 골라야 했습니다. vmdk는 VMware 세상에서 건너온 이들을 위한 이정표 같았습니다. 고민 끝에 저는 qcow2를 선택했습니다. 처음에는 필요한 만큼만 공간을 사용하다가 데이터가 늘어남에 따라 점차 커지는 '씬 프로비저닝' 기능은 마치 공간을 효율적으로 쓰는 지혜와 같았고, 언제든 특정 시점으로 시스템을 되돌릴 수 있는 스냅샷 기능은 예기치 못한 사고에 대비하는 든든한 보험처럼 느껴졌습니다.

Directory와 qcow2의 조합은 훌륭했습니다. 시간이 흘러 더 복잡한 스토리지를 능숙하게 다루게 된 지금도, 저는 여전히 이 길을 즐겨 찾습니다. ISO 이미지나 템플릿, 백업 파일들을 보관하는 데 이보다 더 간단하고 확실한 방법은 없기 때문입니다. 이 경험을 통해 저는 가장 단순한 도구가 특정 목적에는 가장 완벽한 해답이 될 수 있다는 지혜를 얻었습니다. 하지만 가상머신의 순수한 성능과 더 정교한 관리에 대한 갈증은 저를 더 전문적인 길로 나아가게 만들었습니다.

2.2. 정교함의 세계로: LVM과 LVM-thin

파일이라는 껍질을 벗고 디스크의 속살, 즉 '블록'을 직접 다루는 세계로 들어서는 것은 시스템 관리에 있어 한 단계 더 깊이 들어섬을 의미했습니다. LVM(Logical Volume Manager)은 저에게 그 세계로 들어가는 문이었습니다.

처음에는 고성능을 위해 디스크 공간을 미리 모두 할당하는 일반 LVM을 시도했습니다. 이 방식은 성능 저하의 변수를 원천 차단하는 확실한 선택이었지만, 저의 다양한 테스트 환경에서는 할당된 공간 대부분이 비어있는 경우가 많았습니다. 바로 그때, 저는 LVM-thin이라는 더 영리한 대안을 발견했습니다. 필요한 만큼만 공간을 할당하고, 나머지는 예비 공간으로 남겨두는 씬 프로비저닝은 마치 마법 같은 공간 절약술이었습니다. 게다가 블록 레벨에서 직접 지원하는 스냅샷 기능은 안전한 실험을 위한 시간 여행을 가능하게 해주었습니다. 이것은 'LVM이 틀렸다'는 것이 아니라, '상황에 맞는 더 나은 선택이 있다'는 깨달음이었습니다.

LVM-thin은 저에게 만족감을 주었지만, 마음 한편에서는 더 깊은 무언가에 대한 갈증이 피어올랐습니다. 단순한 공간 관리를 넘어, 데이터의 무결성을 보장하고, 압축과 같은 고급 기능을 통해 스토리지 자체를 하나의 유기적인 시스템으로 만들고 싶다는 욕심이었습니다. 그 갈증은 저를 궁극의 목적지, ZFS로 이끌었습니다.

2.3. 깊고 거대한 숲, ZFS를 탐험하다

ZFS는 단순한 파일 시스템이나 볼륨 매니저가 아니었습니다. 그것은 스토리지 관리의 패러다임을 바꾸는 거대하고 깊은 숲과 같았습니다. 처음 ZFS의 세계에 들어섰을 때, 그 복잡성과 수많은 개념 앞에서 다시 한번 막막함을 느꼈지만, 동시에 그 강력함에 매료되었습니다.

저는 여러 개의 물리 디스크들을 모아 zpool이라는 거대한 연못을 만드는 것으로 탐험을 시작했습니다. 그 연못이 마르지 않도록 미러링이나 RAID-Z 같은 vdev라는 튼튼한 둑을 쌓았습니다. 그리고 그 위에 가상머신을 위한 zvol(블록 디바이스)이라는 구획을 나누고, 데이터를 담을 dataset(파일 시스템)을 만들었습니다. 이 모든 과정은 하나의 통일된 명령어로 관리되었고, 데이터의 안정성을 최우선으로 고려하는 ZFS의 철학을 느낄 수 있었습니다.

이 깊은 숲을 탐험하며 저는 ZFS의 성능을 좌우하는 핵심 요소들을 발견했습니다. 첫 번째는 ARC였습니다. RAM을 활용해 자주 쓰는 데이터를 기억해두는 '똑똑한 두뇌 캐시'였죠. 충분한 RAM만 있다면 디스크를 거치지 않고도 놀라운 읽기 속도를 보여주었습니다. 하지만 이 두뇌의 단기 기억력만으로는 부족할 때가 있었습니다. 그때 L2ARC라는 존재를 알게 되었습니다. 빠른 SSD를 L2ARC로 추가하자, ARC가 미처 기억하지 못하는 데이터들을 꺼내올 수 있는 '빠른 참고 서적'이 생긴 것처럼 읽기 성능이 한 단계 더 도약했습니다.

쓰기 성능의 비밀은 ZIL과 SLOG에 있었습니다. ZIL, 즉 쓰기 작업을 기록하는 '업무 일지'는 ZFS의 안정성을 보장하는 핵심 기능이었습니다. 여기에 SLOG라는 전용 고속 SSD를 할당해주자, 이 일지 기록 작업만을 전담하는 충실한 비서가 생긴 것처럼 동기식 쓰기 성능이 극적으로 향상되었습니다.

험난했지만 보람 있는 ZFS 탐험을 마치고 났을 때, 저는 비로소 강력한 도구를 손에 넣은 장인의 성취감을 느꼈습니다. 이제 중요한 것은 이 도구를 어떻게 잘 관리하고 활용하느냐에 달려 있었습니다.

3. 에필로그: 지도를 손에 넣고 길을 나서다

3.1. 여정의 교훈: 상황에 맞는 최적의 도구

길고 긴 스토리지 유랑의 끝에서 제가 얻은 가장 큰 교훈은, 세상에 '완벽한 단 하나의 정답'은 없다는 사실이었습니다. 대신, 주어진 상황과 목적에 맞는 '최적의 해답'이 존재할 뿐이었습니다. 이제 저는 파일의 세계와 블록의 세계를 언제 넘나들어야 하는지 아는 지혜, 즉 한 손에 잘 벼린 도구들과 다른 한 손에는 그것을 언제 어떻게 써야 할지 알려주는 지도를 함께 쥐게 되었습니다.

이제 나는 파일의 유연함이 필요할 때(ISO, 템플릿)는 dir의 세계에 머무르고, 가상머신에게는 블록의 견고한 성능을 직접 선물해주기 위해 lvmthin이나 zfs의 세계로 초대합니다. 만약 여러 서버가 협력하는 클러스터 환경을 구축한다면 분산 스토리지인 rbd(Ceph)를 진지하게 고려할 것이고, 여러 노드 간의 실시간 마이그레이션이 필요하다면 nfs와 같은 공유 스토리지를 활용할 것입니다. 이것이 저만의 스토리지 활용 원칙입니다.

이 여정을 통해 얻은 기술적 지혜도 있습니다. 결국 가장 중요한 것은 가상머신에 맞는 최적의 VirtIO 드라이버를 잊지 않는 것, SSD는 none으로, HDD는 writeback으로 캐시 모드를 다르게 설정하는 지혜였습니다. 또한 파일 기반 스토리지에서는 qcow2의 유연함을 활용하고, LVM-thin이나 ZFS 같은 블록 기반 스토리지를 선택함으로써 중간 파일 계층 없이 디스크에 직접 접근하는 raw와 같은 순수한 성능을 얻어내는 안목을 갖게 되었습니다. ZFS를 다룰 때는 충분한 RAM과 빠른 SLOG용 SSD가 단순한 사치가 아니라 필수적인 투자임을 몸소 깨달았습니다.

3.2. 새로운 여정을 향하여

Proxmox 스토리지라는 복잡한 세계를 탐험하는 여정은 처음에는 두려움과 막막함으로 가득했습니다. 하지만 한 걸음씩 내디디며 각 스토리지의 철학을 이해하고 그 특성을 몸으로 부딪혀 배우는 과정은, 결국 시스템의 가장 근본적인 토대를 이해하는 값진 경험이 되었습니다.

이제 스토리지라는 단단한 땅을 다졌으니, 다음은 그 위에서 마음껏 달릴 가상머신(KVM)과 컨테이너(LXC)의 세계로 떠나볼 차례입니다. 이 새로운 여정 또한 낯설고 도전적이겠지만, 이미 하나의 지도를 완성해 본 경험이 있기에 두렵지 않습니다. 또 다른 흥미로운 탐험이 될 그 길에, 당신도 함께하지 않으시겠습니까?
