---
title: "Proxmox Availability 1"
date: "2026-01-15"
category: "proxmox"
tags: ["proxmox", "태그2", "태그3"]
excerpt: "게시글 요약을 작성하세요"
readTime: "5분"
---

# 내 작은 서버가 잠들지 않도록: Proxmox 고가용성(HA) 클러스터 이야기

---

### **1. 도입: 한밤중의 불안함, 그리고 팀을 꾸린다는 것**

한밤중에 울리는 장애 알람을 받아보신 적 있나요? 중요한 서비스가 멈췄다는 차가운 메시지는 개발자나 시스템 운영자에게 익숙한 불안감의 다른 이름입니다. 아무리 잘 만든 시스템이라도 단 하나의 서버에 의존하는 것은, 모든 짐을 홀로 짊어진 채 아슬아슬한 외줄을 타는 것과 같습니다. 언제든 발을 헛디딜 수 있다는 불안감을 안고서 말이죠. 이 근원적인 문제를 해결하기 위해, 우리는 한 대의 영웅적인 서버에 기대는 대신, 여러 서버가 힘을 합쳐 하나의 팀을 이루는 '클러스터'라는 지혜로운 해결책을 선택합니다.

이것은 단순히 하드웨어를 늘리는 기술적 행위를 넘어섭니다. 클러스터를 구축하는 과정은 서로 다른 개체들에게 '협력'의 규칙을 가르치고, '신뢰'의 시스템을 만드는 여정과 같습니다. 혼자일 때의 외로움과 위험을 극복하고, 서로의 상태를 살피며 위기 상황에 함께 대처하는 유기적인 공동체를 조직하는 일입니다. 어떻게 하면 서버들이 서로를 믿고 의지하며, 하나의 유기적인 팀처럼 움직이게 만들 수 있을까요? 이 글은 그 흥미로운 여정에 대한 이야기입니다.

### **2. 본문: 서로를 믿고 의지하는 서버들의 세계**

이제 우리는 서버들이 어떻게 하나의 팀으로 거듭나는지, 그 핵심 원리를 탐험해 볼 차례입니다. 기술적인 개념들을 건조하게 나열하는 대신, 각 요소가 마치 오케스트라의 악기처럼 어떻게 조화롭게 협력하여 '고가용성'이라는 아름다운 음악을 연주하는지 그 흐름을 따라가 보겠습니다. 이 세계에는 명확한 규칙과 약속, 그리고 때로는 어려운 결단이 존재합니다.

#### **2.1. 끊임없는 대화의 시작 (Corosync)**

팀이 유지되기 위한 가장 기본적인 조건은 '소통'입니다. Proxmox 클러스터에서 이 중요한 역할을 맡은 것이 바로 **Corosync**입니다. Corosync는 서버들 사이에 흐르는 끊임없는 대화이자, 서로의 안부를 묻는 규칙적인 심장박동과 같습니다. 각 서버(노드)는 Corosync를 통해 "나는 아직 살아있어, 너는 어떠니?"라고 주기적으로 메시지를 주고받습니다.

이 끊임없는 대화는 단순한 안부 인사를 넘어, 모두가 같은 악보, 즉 동일한 설정을 공유하도록 보장하는 역할도 합니다. 그래야만 오케스트라가 한 치의 오차도 없이 완벽한 하모니를 이룰 수 있기 때문입니다. 이 소통을 통해 클러스터는 어떤 멤버가 팀에 속해 있는지(노드 멤버십 관리), 중요한 정보는 모두에게 어떻게 전달할지(그룹 통신)를 결정합니다. 자, 이제 서로의 존재를 확인했으니, 그 다음으로 중요한 것은 '어떻게 함께 결정을 내릴 것인가'라는 문제입니다.

#### **2.2. 혼란을 막는 민주주의 (Quorum)**

여러 서버가 함께 일할 때 가장 위험한 상황은 바로 **'스플릿 브레인(split-brain)'**입니다. 이는 마치 통신 문제로 팀이 둘로 쪼개져, 각 그룹이 서로 다른 리더를 따르며 혼란에 빠지는 모습과 같습니다. 양쪽에서 똑같은 서비스를 동시에 실행하려 들면 데이터는 엉망이 되고 시스템 전체가 붕괴될 수 있습니다.

이러한 혼란을 막기 위해 클러스터는 **쿼럼(Quorum)**이라는 민주적인 의사결정 원칙을 사용합니다. 쿼럼은 '의사결정을 위해 필요한 최소한의 동의자 수'를 의미하며, 보통 '과반수'의 원칙을 따릅니다. 클러스터는 과반수 이상의 멤버가 동의할 때만 중요한 작업을 수행합니다. 덕분에 네트워크가 단절되어 소수 그룹으로 고립된 노드들은 섣불리 행동하지 않고 다수의 결정을 기다리게 됩니다.

이것이 바로 클러스터 노드를 3개, 5개와 같이 홀수로 구성하길 권장하는 이유입니다. 짝수일 때보다 동점이 발생할 확률이 적어 더 안정적으로 과반수를 형성할 수 있기 때문이죠. 때로는 **QDevice**라는 외부 투표 장치를 두어, 동점 상황에서 '결정적인 한 표'를 던지는 현명한 중재자 역할을 맡기기도 합니다.

#### **2.3. 지휘자와 연주자 (CRM & LRM)**

민주적인 합의를 통해 행동 방침이 정해졌다면, 이제는 일사불란하게 움직여야 합니다. Proxmox의 고가용성(HA) 스택은 마치 잘 훈련된 오케스트라처럼 움직입니다. 이 오케스트라에는 전체를 조율하는 지휘자와 각자의 파트를 충실히 연주하는 연주자들이 있습니다.

- **지휘자, CRM (Cluster Resource Manager):** CRM은 클러스터 전체 상황을 조망하는 지휘자입니다. 어떤 서비스가 어떤 노드에서 실행 중인지, 노드에 장애가 발생했는지 등을 종합적으로 파악합니다. 만약 특정 노드에 문제가 생기면, CRM은 어떤 서비스를 어느 노드로 옮겨야 할지 결정하고 지시를 내립니다.
- **연주자, LRM (Local Resource Manager):** 각 서버에는 LRM이라는 충실한 연주자가 있습니다. LRM은 오직 자신이 속한 서버의 상태만 관리하며, 중앙의 지휘자인 CRM으로부터 받은 명령을 충실히 수행합니다. "A 서비스를 시작하라" 또는 "B 서비스를 중지하라"와 같은 지시를 받아 실제 작업을 실행하는 역할입니다.

이처럼 CRM이 전역적인 결정을 내리고 각 노드의 LRM이 이를 실행하는 구조 덕분에, 클러스터는 혼란 없이 신속하고 정확하게 위기 상황에 대처할 수 있습니다.

#### **2.4. 비상시의 마지막 안전장치 (Fencing)**

하지만 만약 한 연주자가 갑자기 지휘를 무시하고 제멋대로 연주를 시작하거나, 혹은 아무런 소리도 내지 않고 침묵에 빠진다면 어떻게 될까요? 오케스트라 전체가 불협화음의 재앙에 빠질 수 있습니다. 응답이 없다고 섣불리 그 연주자의 파트를 다른 이에게 넘겨주었다간, 잠시 후 정신을 차린 원래 연주자와 충돌하며 모든 것을 망쳐버릴 수 있습니다.

이때 필요한 것이 바로 **펜싱(Fencing)**이라는 어려운 결단입니다. 펜싱은 문제가 발생한 노드를 클러스터 자원에서 확실하게 격리하여 추가적인 피해를 막는 최후의 조치입니다. 이는 전체를 지키기 위해 문제가 생긴 동료를 잠시 시스템에서 제외하는 냉정하지만 반드시 필요한 과정입니다.

Proxmox는 주로 **워치독(Watchdog)** 타이머를 이용한 자가 격리(self-fencing) 방식을 사용합니다. 각 서버의 워치독은 '최후의 안전핀'과 같습니다. 만약 서버가 스스로 제어 불능 상태에 빠졌다고 판단하면, 워치독은 시스템을 강제로 재부팅하여 다른 노드들이 해당 서버의 서비스를 안전하게 이어받을 수 있도록 길을 터줍니다.

#### **2.5. 이 모든 것을 다루는 손길 (주요 명령어)**

이 복잡하고 지능적인 시스템을 우리는 몇 가지 간단한 명령어로 다룰 수 있습니다. 클러스터라는 팀을 처음 만들 때는 `pvecm create`라는 주문을 외우고, 새로운 친구를 팀에 초대할 땐 `pvecm add`를 사용합니다. `pvecm status` 명령으로는 우리 팀이 건강한지 언제든 확인할 수 있죠.

그리고 우리가 지키고 싶은 소중한 서비스가 있다면, `ha-manager add` 명령으로 보호 목록에 올려주기만 하면 됩니다. 그 순간부터 클러스터는 지휘자와 연주자, 그리고 모든 안전장치를 동원해 그 서비스가 잠들지 않도록 지켜줄 것입니다. 때로는 오케스트라의 연주자 위치를 재배치해야 할 때도 있습니다. 정비를 위해 잠시 서비스를 다른 서버로 옮기고 싶을 땐 `ha-manager migrate`라는 부드러운 요청으로, 단 한 순간의 쉼도 없이 안전하게 자리를 옮길 수 있죠.

### **3. 마무리: 잠들지 않는 서버, 그리고 얻게 된 마음의 평화**

Proxmox HA 클러스터를 구축하는 여정은 단순히 기술적 과제를 해결하는 것을 넘어섭니다. 우리는 예측 불가능한 장애에 대비하는 시스템을 통해, 기술의 가장 밑바닥에 '안정감'과 '신뢰'라는 가치를 쌓아 올린 것입니다. 돌이켜보면 이 모든 과정은 결국 서버들이 하나의 팀으로 거듭나는 이야기였습니다.

서로 끊임없이 대화하고( **Corosync** ), 다수결로 현명하게 결정하며( **Quorum** ), 지휘자와 연주자처럼 일사불란하게 움직이는( **HA 스택** ) 하나의 팀을 만드는 과정이었습니다. 때로는 전체를 위해 아픈 결단( **Fencing** )도 내려야 했습니다.

이 복잡해 보이는 과정이 우리에게 선물하는 것은 결국 '마음 편히 잠들 수 있는 밤'입니다. 이제 우리의 작은 서버는 더 이상 혼자가 아닙니다. 서로를 지켜주는 든든한 동료들과 함께, 오늘도 잠들지 않고 묵묵히 우리를 기다려줄 겁니다.
