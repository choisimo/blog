---
title: "Stop-the-world의 숨결을 들으며, GC와 화해한 나의 기록"
date: "2025-10-26"
category: "Java"
tags: ['Java', 'GarbageCollection', 'JVM', 'G1', '메모리관리']
excerpt: "Serial, CMS, G1을 거치며 힙 덤프와 함께 밤을 지새운 개발자가 GC의 진화와 전략을 되돌아본 일기"
readTime: "11분"
---

2007년 어느 날 새벽, 서버 로그에 찍힌 “Full GC (System) pause 5000ms”라는 메시지를 보고 숨이 멎는 줄 알았다. 사용자는 5초 동안 아무 것도 할 수 없었고, 우리는 손에 땀을 쥐고 힙 덤프를 뒤졌다. 그때부터 나의 Garbage Collection 탐험이 시작됐다. 파란색 힙 그래프가 들쭉날쭉한 캔버스처럼 보일 정도로 매일 보며 살았다.

처음에는 Serial GC와 Parallel GC 정도만 알고 있던 내가, CMS(Concurrent Mark-Sweep)의 mark 단계와 remark 단계가 어떻게 다른지 이해하려면 꽤 시간이 걸렸다. stop-the-world가 얼마나 짧아졌는지 확인하고, promotion 실패로 fallback이 일어나면 왜 그런지 분석했다. JVM 옵션에 `-XX:+UseConcMarkSweepGC`를 넣으면서도 “이게 정말 우리 서비스에 도움이 될까?”라는 의심을 떨치지 못했다. 결국 생산 환경에서 CMS가 동작하는 모습을 확인하던 날, 관찰 노트에 “remark 80ms, concurrent sweep 400ms”라고 적어 두었다. 그 숫자들이 내 마음을 진정시켜 주었다.

그러나 CMS의 fragmenation 문제는 결국 우리를 새로운 대안으로 몰아갔다. G1(Garbage-First) GC가 등장했을 때, 나는 JDK6u14 early access 빌드를 받아 테스트 환경에 먼저 적용했다. 힙을 리전(region) 단위로 나눠 가장 많이 쓰레기가 쌓인 구역부터 청소한다는 개념은 매력적이었다. GC 로그 분석 도구로 리전별 히트맵을 보면서, G1이 예측 가능한 pause time을 제공한다는 사실을 눈으로 확인했다. “-XX:MaxGCPauseMillis=200” 옵션이 실제로 얼마나 잘 지켜지는지 측정하고, 일지에 손수 그래프를 그렸다. 짧고 잦은 GC가 때로는 긴 멈춤보다 훨씬 낫다는 것을 그때 배웠다.

메모리 누수를 추적하던 시절도 잊을 수 없다. VisualVM과 MAT(Memory Analyzer Tool)을 번갈아 켜고, dominator tree를 분석하면서 after-GC에서 살아남는 객체 참조를 찾았다. `SoftReference`와 `WeakReference`의 차이를 이해하고, 캐시 전략을 다시 설계한 밤이 몇 번이나 되는지 모른다. GC는 단지 자동 메모리 회수 시스템이 아니라, 애플리케이션 설계 철학을 되돌아보게 만드는 거울이라는 사실을 깨달았다. 강한 참조를 적절히 끊지 않으면, 아무리 좋은 GC 알고리즘도 도움이 되지 않았다.

한동안 나는 Concurrent Mark Sweep과 G1 사이를 오가며 프로젝트 특성에 맞는 GC를 찾는 데 집중했다. 레이턴시가 최우선인 서비스에서는 CMS를, 대용량 데이터를 처리해야 하는 시스템에서는 G1을 시험했다. 그리고 JDK 11 이후에 등장한 ZGC와 Shenandoah의 소식을 들으며, 우리 팀이 언젠가 초저지연 GC를 도입할 수 있을지 기대했다. 아직 본격적으로 프로덕션에 적용하지는 않았지만, pause time이 몇 밀리초로 떨어지는 데모를 보았을 때는 가슴이 뛰었다.

지금은 GC 로그가 예전만큼 무섭지 않다. Fluent Bit와 Grafana 대시보드에 연결된 파란 곡선을 보며, 얼마나 안정적으로 힙이 재활용되고 있는지 확인한다. 여전히 가끔은 stop-the-world로 인한 불만이 접수되지만, 이제는 어떤 옵션을 조정하고 어떤 코드 패턴을 수정해야 할지 감이 온다. GC 튜닝은 결국 시스템 이해와 애플리케이션 설계가 맞물릴 때 의미가 있다는 것을 알게 되었으니까.

오늘도 배포 전 마지막 점검에서 GC 대시보드를 살펴봤다. 200ms 내외의 pause가 규칙적으로 나타나고, 힙 사용량은 안정적으로 톱니파형을 그린다. 모니터를 보며 나는 속으로 중얼거렸다. “감사해, GC. 우리가 더 나은 코드를 쓰도록 계속 압박해 줘서.” JVM 내부에서 묵묵히 돌아가는 수집기의 숨결을 들으며, 나는 내일의 튜닝 포인트를 떠올린다. Garbage Collection과 보낸 수많은 밤이 결국 나를 성장시켰다는 사실을 이제는 기쁘게 인정한다.
