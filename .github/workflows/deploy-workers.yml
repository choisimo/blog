name: "[DEPRECATED] Deploy Legacy Blog API Worker"

# =============================================================================
# ‚ö†Ô∏è DEPRECATED - This workflow is no longer used
# =============================================================================
# This workflow deployed the old blog-api/blog-api-prod workers.
# These have been replaced by the unified blog-api-gateway.
#
# New workflow: deploy-api-gateway.yml
# New worker: workers/api-gateway/
#
# This file is kept for reference only and will be removed in a future cleanup.
# =============================================================================

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'Type "CONFIRM" to deploy legacy worker (not recommended)'
        required: true

jobs:
  deprecated-notice:
    runs-on: ubuntu-latest
    steps:
      - name: Deprecation Warning
        run: |
          echo "‚ö†Ô∏è WARNING: This workflow is DEPRECATED"
          echo ""
          echo "The blog-api and blog-api-prod workers have been replaced by:"
          echo "  ‚Üí blog-api-gateway (unified worker)"
          echo ""
          echo "Please use the new workflow instead:"
          echo "  ‚Üí .github/workflows/deploy-api-gateway.yml"
          echo ""
          echo "To deploy the new unified gateway:"
          echo "  1. Go to Actions ‚Üí 'Deploy Blog API Gateway (Unified)'"
          echo "  2. Click 'Run workflow'"
          echo ""
          exit 1

  deploy-legacy:
    runs-on: ubuntu-latest
    needs: deprecated-notice
    if: ${{ github.event.inputs.confirm == 'CONFIRM' }}
    permissions:
      contents: read
    env:
      CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: workers/package-lock.json

      - name: Install Wrangler 4
        working-directory: workers
        run: npm install --save-dev wrangler@4

      - name: Install dependencies
        working-directory: workers
        run: npm ci --ignore-scripts

      - name: Type check
        working-directory: workers
        run: npm run typecheck

      - name: Deploy to Cloudflare Workers (production)
        working-directory: workers
        run: npx wrangler deploy --env production

      - name: Deployment summary
        run: |
          echo "‚ö†Ô∏è LEGACY worker deployed"
          echo "üì¶ Environment: production"
          echo "üåç Endpoint: https://blog-api-prod.immuddelo.workers.dev"
          echo ""
          echo "Please migrate to blog-api-gateway as soon as possible!"
