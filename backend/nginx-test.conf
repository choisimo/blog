# =============================================================================
# Nginx Reverse Proxy Configuration - Test Environment (Frontend Only)
# =============================================================================
# Architecture:
#   Cloudflare Tunnel → Nginx → Frontend SPA
#   Frontend → api.nodove.com (external backend via Cloudflare Tunnel)
#
# Routes:
#   - blog-test.nodove.com/* → Frontend SPA
#
# Backend:
#   Frontend connects directly to https://api.nodove.com (no proxy needed)
# =============================================================================

# -----------------------------------------------------------------------------
# Upstream Definitions (Docker internal network)
# -----------------------------------------------------------------------------
upstream frontend_upstream {
  server frontend:80;
}

# -----------------------------------------------------------------------------
# Main Server (blog-test.nodove.com) - Frontend Only
# -----------------------------------------------------------------------------
server {
  listen 80;
  server_name blog-test.nodove.com _;
  client_max_body_size 2m;

  # Health check
  location = /health {
    add_header Content-Type application/json;
    return 200 '{"status":"ok","service":"nginx-test"}';
  }

  # Frontend (SPA) - all routes
  location / {
    proxy_pass http://frontend_upstream;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
