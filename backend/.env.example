# =============================================================================
# Blog Backend - Environment Configuration
# =============================================================================
# Copy to .env and fill in values
#
# Architecture: Frontend -> Workers -> Backend
#   - Frontend: GitHub Pages (noblog.nodove.com)
#   - Workers: Cloudflare Workers (api.nodove.com) - Edge Gateway
#   - Backend: Self-hosted Docker (this server)
#
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
APP_ENV=production
HOST=0.0.0.0
PORT=5080
TRUST_PROXY=1
LOG_LEVEL=info

# GitHub Repository Owner (for GHCR image pulls)
GITHUB_REPOSITORY_OWNER=choisimo

# -----------------------------------------------------------------------------
# Security: Backend Authentication Key
# -----------------------------------------------------------------------------
# Shared secret between Workers and Backend
# Workers sends this in X-Backend-Key header
# Generate with: openssl rand -hex 32
BACKEND_SECRET_KEY=

# Origin secret for terminal server WebSocket authentication
ORIGIN_SECRET_KEY=

# -----------------------------------------------------------------------------
# URLs & CORS
# -----------------------------------------------------------------------------
SITE_BASE_URL=https://noblog.nodove.com
API_BASE_URL=https://api.nodove.com
ALLOWED_ORIGINS=https://noblog.nodove.com,http://localhost:5173

# Rate limiting
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# -----------------------------------------------------------------------------
# Consul Service Discovery (Optional)
# -----------------------------------------------------------------------------
# When enabled, config is loaded from Consul KV with environment fallback
# Consul KV schema: blog/config/*, blog/services/*
USE_CONSUL=false
CONSUL_HOST=consul
CONSUL_PORT=8500

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_DB=blog
POSTGRES_USER=blog
POSTGRES_PASSWORD=

# -----------------------------------------------------------------------------
# Redis Cache
# -----------------------------------------------------------------------------
REDIS_PASSWORD=
REDIS_URL=redis://redis:6379

# AI Worker Configuration (for async queue processing)
AI_WORKER_NAME=worker-1
AI_WORKER_BATCH_SIZE=1
AI_WORKER_BLOCK_TIME=5000

# -----------------------------------------------------------------------------
# AI Provider Configuration
# -----------------------------------------------------------------------------
# All AI requests go through AI Gateway (internal reverse proxy)
# Architecture: Blog API → ai-gateway:7000 → ai-server-backend/serve → LLM

# =============================================================================
# AI Gateway (Primary - Recommended)
# =============================================================================
AI_GATEWAY_URL=http://ai-gateway:7000
AI_API_KEY=
AI_DEFAULT_MODEL=gpt-4.1
AI_DEFAULT_PROVIDER=github-copilot

# Async Mode: Route AI requests through Redis Streams for async processing
# When enabled, AI requests are queued and processed by workers
# Requires Redis to be available. Falls back to sync mode if Redis is unavailable.
# Options: true | false (default: false)
AI_ASYNC_MODE=false

# AI Rate Limiting (Redis-based, cross-instance)
AI_RATE_LIMIT_WINDOW_MS=60000
AI_RATE_LIMIT_MAX=30

# OpenAI SDK Compatible (auto-configured from AI_GATEWAY_URL)
OPENAI_API_BASE_URL=http://ai-gateway:7000/v1

# =============================================================================
# Legacy OpenCode (Backward Compatibility)
# =============================================================================
OPENCODE_BASE_URL=http://ai-gateway:7000
OPENCODE_API_KEY=

# n8n AI Gateway (Docker internal, fallback)
N8N_BASE_URL=http://n8n:5678
N8N_WEBHOOK_URL=https://blog-bw.nodove.com/
N8N_HOST=blog-bw.nodove.com
N8N_EDITOR_BASE_URL=https://blog-bw.nodove.com
N8N_API_KEY=

# Hybrid Mode: Route LLM calls through AI Gateway
USE_OPENCODE_FOR_LLM=true

# External Provider API Keys (for n8n direct integrations)
EXTERNAL_GOOGLE_API_KEY=
EXTERNAL_OPENAI_API_KEY=
EXTERNAL_ANTHROPIC_API_KEY=

# -----------------------------------------------------------------------------
# n8n Workflow Engine
# -----------------------------------------------------------------------------
N8N_USER=admin
N8N_PASS=
# Generate with: openssl rand -hex 32
N8N_ENCRYPTION_KEY=
# Number of worker replicas (default: 2)
N8N_WORKER_REPLICAS=2

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
JWT_EXPIRES_IN=12h
JWT_SECRET=

# -----------------------------------------------------------------------------
# n8n Webhook Integration (Aidove)
# -----------------------------------------------------------------------------
AIDOVE_WEBHOOK_URL=https://blog-bw.nodove.com/webhook/aidove
AIDOVE_RAG_WEBHOOK_URL=https://blog-bw.nodove.com/webhook/aidove-rag
AIDOVE_API_KEY=
AIDOVE_WEBHOOK_TIMEOUT=120000

# -----------------------------------------------------------------------------
# Cloudflare D1 Database
# -----------------------------------------------------------------------------
CF_ACCOUNT_ID=
CF_API_TOKEN=
D1_DATABASE_ID=

# -----------------------------------------------------------------------------
# Cloudflare R2 Storage
# -----------------------------------------------------------------------------
R2_BUCKET_NAME=blog
R2_ASSETS_BASE_URL=https://assets-b.nodove.com

# -----------------------------------------------------------------------------
# GitHub Integration (Admin PR creation)
# -----------------------------------------------------------------------------
GITHUB_TOKEN=
GITHUB_REPO_OWNER=choisimo
GITHUB_REPO_NAME=blog
GIT_USER_NAME=CI Bot
GIT_USER_EMAIL=ci@example.com

# -----------------------------------------------------------------------------
# Admin Authentication
# -----------------------------------------------------------------------------
ADMIN_BEARER_TOKEN=
ADMIN_USERNAME=
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# MinIO Object Storage (Optional)
# -----------------------------------------------------------------------------
MINIO_USER=minioadmin
MINIO_PASSWORD=

# -----------------------------------------------------------------------------
# Firecrawl Web Scraper (Optional)
# -----------------------------------------------------------------------------
FIRECRAWL_API_TOKEN=

# -----------------------------------------------------------------------------
# Terminal Server
# -----------------------------------------------------------------------------
SANDBOX_IMAGE=alpine:latest

# -----------------------------------------------------------------------------
# Monitoring (Optional - enable with --profile monitoring)
# -----------------------------------------------------------------------------
GRAFANA_PASSWORD=

# -----------------------------------------------------------------------------
# Admin Tools (Optional - enable with --profile admin)
# -----------------------------------------------------------------------------
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=
