# =============================================================================
# Blog Backend - Environment Configuration
# =============================================================================
# Copy to .env and fill in values
#
# Architecture: Frontend -> Workers -> Backend
#   - Frontend: GitHub Pages (noblog.nodove.com)
#   - Workers: Cloudflare Workers (api.nodove.com) - Edge Gateway
#   - Backend: Self-hosted Docker (this server)
#
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
APP_ENV=production
HOST=0.0.0.0
PORT=5080
TRUST_PROXY=1
LOG_LEVEL=info

# GitHub Repository Owner (for GHCR image pulls)
GITHUB_REPOSITORY_OWNER=choisimo

# -----------------------------------------------------------------------------
# Security: Backend Authentication Key
# -----------------------------------------------------------------------------
# Shared secret between Workers and Backend
# Workers sends this in X-Backend-Key header
# Generate with: openssl rand -hex 32
BACKEND_SECRET_KEY=

# Origin secret for terminal server WebSocket authentication
ORIGIN_SECRET_KEY=

# -----------------------------------------------------------------------------
# URLs & CORS
# -----------------------------------------------------------------------------
SITE_BASE_URL=https://noblog.nodove.com
API_BASE_URL=https://api.nodove.com
ALLOWED_ORIGINS=https://noblog.nodove.com,http://localhost:5173

# Rate limiting
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_DB=blog
POSTGRES_USER=blog
POSTGRES_PASSWORD=

# -----------------------------------------------------------------------------
# Redis Cache
# -----------------------------------------------------------------------------
REDIS_PASSWORD=

# -----------------------------------------------------------------------------
# MongoDB Database
# -----------------------------------------------------------------------------
MONGO_USER=blog
MONGO_PASSWORD=
MONGO_DB=blog

# -----------------------------------------------------------------------------
# Qdrant Vector Database
# -----------------------------------------------------------------------------
# Generate with: openssl rand -hex 32
QDRANT_API_KEY=

# -----------------------------------------------------------------------------
# AI Provider Configuration
# -----------------------------------------------------------------------------
# Provider: 'opencode' (primary - OpenCode backend container, @opencode-ai/sdk)
#           'n8n' (uses n8n webhooks)
#           'vas' (VAS OpenCode engine)
#           'gemini' (direct Gemini API)
AI_PROVIDER=opencode

# =============================================================================
# OpenCode Backend (Primary)
# =============================================================================
# Docker images:
#   - opencode-serve: ghcr.io/choisimo/opencode-serve:latest (port 7012)
#   - opencode-backend: ghcr.io/choisimo/opencode-backend:latest (port 7016)
#
# Architecture:
#   Blog Backend -> opencode-backend:7016 -> opencode:7012 -> LLM Provider
# =============================================================================
# Used by n8n workflows (internal Docker network)
OPENCODE_BASE_URL=http://opencode-backend:7016
OPENCODE_API_KEY=
OPENCODE_DEFAULT_PROVIDER=github-copilot
OPENCODE_DEFAULT_MODEL=gpt-4.1

# n8n AI Gateway (Docker internal, fallback)
N8N_BASE_URL=http://n8n:5678
N8N_WEBHOOK_URL=https://blog-bw.nodove.com/
N8N_HOST=blog-bw.nodove.com
N8N_EDITOR_BASE_URL=https://blog-bw.nodove.com
N8N_API_KEY=
AI_DEFAULT_MODEL=gemini-1.5-flash

# Hybrid Mode: Route LLM calls through OpenCode
# true (default): LLM calls go through OpenCode, non-LLM tasks through n8n
# false: All AI calls go through n8n webhooks (legacy mode)
USE_OPENCODE_FOR_LLM=true

# Provider API Keys (used by n8n AI nodes and OpenCode)
GOOGLE_API_KEY=
OPENAI_API_KEY=
ANTHROPIC_API_KEY=

# -----------------------------------------------------------------------------
# n8n Workflow Engine
# -----------------------------------------------------------------------------
N8N_USER=admin
N8N_PASS=
# Generate with: openssl rand -hex 32
N8N_ENCRYPTION_KEY=
# Number of worker replicas (default: 2)
N8N_WORKER_REPLICAS=2

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
JWT_EXPIRES_IN=12h
JWT_SECRET=

# -----------------------------------------------------------------------------
# n8n Webhook Integration (Aidove)
# -----------------------------------------------------------------------------
AIDOVE_WEBHOOK_URL=https://blog-bw.nodove.com/webhook/aidove
AIDOVE_RAG_WEBHOOK_URL=https://blog-bw.nodove.com/webhook/aidove-rag
AIDOVE_API_KEY=
AIDOVE_WEBHOOK_TIMEOUT=120000

# -----------------------------------------------------------------------------
# Cloudflare D1 Database
# -----------------------------------------------------------------------------
CF_ACCOUNT_ID=
CF_API_TOKEN=
D1_DATABASE_ID=

# -----------------------------------------------------------------------------
# Cloudflare R2 Storage
# -----------------------------------------------------------------------------
R2_BUCKET_NAME=blog
R2_ASSETS_BASE_URL=https://assets-b.nodove.com

# -----------------------------------------------------------------------------
# GitHub Integration (Admin PR creation)
# -----------------------------------------------------------------------------
GITHUB_TOKEN=
GITHUB_REPO_OWNER=choisimo
GITHUB_REPO_NAME=blog
GIT_USER_NAME=CI Bot
GIT_USER_EMAIL=ci@example.com

# -----------------------------------------------------------------------------
# Admin Authentication
# -----------------------------------------------------------------------------
ADMIN_BEARER_TOKEN=
ADMIN_USERNAME=
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# MinIO Object Storage (Optional)
# -----------------------------------------------------------------------------
MINIO_USER=minioadmin
MINIO_PASSWORD=

# -----------------------------------------------------------------------------
# Firecrawl Web Scraper (Optional)
# -----------------------------------------------------------------------------
FIRECRAWL_API_TOKEN=

# -----------------------------------------------------------------------------
# Terminal Server
# -----------------------------------------------------------------------------
SANDBOX_IMAGE=alpine:latest

# -----------------------------------------------------------------------------
# Monitoring (Optional - enable with --profile monitoring)
# -----------------------------------------------------------------------------
GRAFANA_PASSWORD=

# -----------------------------------------------------------------------------
# Admin Tools (Optional - enable with --profile admin)
# -----------------------------------------------------------------------------
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=
