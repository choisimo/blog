# =============================================================================
# Blog Backend - Environment Configuration
# =============================================================================
# Copy to .env and fill in values
#
# All values have sensible defaults in config/constants.js
# Only override what you need to change
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
APP_ENV=production
HOST=0.0.0.0
PORT=5080
TRUST_PROXY=1
LOG_LEVEL=info

# GitHub Repository Owner (for GHCR image pulls)
GITHUB_REPOSITORY_OWNER=choisimo

# -----------------------------------------------------------------------------
# Security: Backend Authentication Key
# -----------------------------------------------------------------------------
# Shared secret between gateway/proxy and backend
# Sent in X-Backend-Key header
# Generate with: openssl rand -hex 32
BACKEND_SECRET_KEY=

# Origin secret for terminal server WebSocket authentication
ORIGIN_SECRET_KEY=

# -----------------------------------------------------------------------------
# URLs & CORS
# -----------------------------------------------------------------------------
SITE_BASE_URL=https://noblog.nodove.com
API_BASE_URL=https://api.nodove.com
ALLOWED_ORIGINS=https://noblog.nodove.com,http://localhost:5173

# Optional public assets base URL (e.g. https://example.com/images). Defaults to SITE_BASE_URL/images
ASSETS_BASE_URL=

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_MAX=60
RATE_LIMIT_WINDOW_MS=60000

# AI-specific rate limiting (stricter limits for expensive operations)
AI_RATE_LIMIT_WINDOW_MS=60000
AI_RATE_LIMIT_MAX=30

# -----------------------------------------------------------------------------
# Timeouts (milliseconds)
# -----------------------------------------------------------------------------
# DEFAULT_TIMEOUT_MS=120000      # 2 minutes - general HTTP timeout
# LONG_TIMEOUT_MS=300000         # 5 minutes - long-running operations
# TOOL_TIMEOUT_MS=30000          # 30 seconds - tool execution
# IMAGE_FETCH_TIMEOUT_MS=5000    # 5 seconds - image downloads
# AI_TASK_WAIT_TIMEOUT_MS=120000 # 2 minutes - async AI task wait
# SSE_PING_INTERVAL_MS=25000     # 25 seconds - SSE keepalive ping

# -----------------------------------------------------------------------------
# Circuit Breaker (for external service failures)
# -----------------------------------------------------------------------------
# CIRCUIT_BREAKER_THRESHOLD=5    # failures before opening circuit
# CIRCUIT_BREAKER_RESET_MS=30000 # time before attempting recovery

# -----------------------------------------------------------------------------
# Cache TTL (milliseconds)
# -----------------------------------------------------------------------------
# CONSUL_CACHE_TTL_MS=30000      # Consul KV cache
# HEALTH_CHECK_CACHE_TTL_MS=10000 # Health check results
# MODEL_LIST_CACHE_TTL_MS=60000  # AI model list
# SESSION_CACHE_TTL_MS=300000    # Session data (5 minutes)

# -----------------------------------------------------------------------------
# Consul Service Discovery (Optional)
# -----------------------------------------------------------------------------
# When enabled, config is loaded from Consul KV with environment fallback
# Consul KV schema: blog/config/*, blog/services/*
USE_CONSUL=false
CONSUL_HOST=consul
CONSUL_PORT=8500
# CONSUL_PREFIX=blog

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
# Set to 'false' to disable features (all default to true)
# FEATURE_AI_ENABLED=true
# FEATURE_RAG_ENABLED=true
# FEATURE_TERMINAL_ENABLED=true
# FEATURE_AI_INLINE=true
# FEATURE_COMMENTS_ENABLED=true

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_DB=blog
POSTGRES_USER=blog
POSTGRES_PASSWORD=

# -----------------------------------------------------------------------------
# Redis Cache
# -----------------------------------------------------------------------------
REDIS_PASSWORD=
REDIS_URL=redis://redis:6379

# -----------------------------------------------------------------------------
# AI Worker Configuration (for async queue processing)
# -----------------------------------------------------------------------------
AI_WORKER_NAME=worker-1
AI_WORKER_BATCH_SIZE=1
AI_WORKER_BLOCK_TIME=5000

# -----------------------------------------------------------------------------
# SQLite Database (Docker deployment)
# -----------------------------------------------------------------------------
# Path to SQLite database file (auto-created if not exists)
SQLITE_PATH=/app/.data/blog.db
# Path to migrations directory (SQL files applied on startup)
SQLITE_MIGRATIONS_DIR=/app/migrations

# -----------------------------------------------------------------------------
# AI Provider Configuration (OpenAI-Compatible)
# -----------------------------------------------------------------------------
# All AI requests route through an OpenAI-compatible API.
# Example: https://api.openai.com/v1 or your gateway endpoint
AI_SERVER_URL=https://api.openai.com/v1

# Primary API key for the AI server (preferred)
AI_API_KEY=
# Optional alias if your provider uses OPENAI_API_KEY
OPENAI_API_KEY=

# -----------------------------------------------------------------------------
# AI Models
# -----------------------------------------------------------------------------
AI_DEFAULT_MODEL=gpt-4.1
# AGENT_MODEL=gpt-4.1           # Model for agent operations (defaults to AI_DEFAULT_MODEL)
# AI_VISION_MODEL=gpt-4o        # Model for vision/image analysis
# PERPLEXITY_MODEL=sonar        # Model for Perplexity AI search

# Fallback models when primary is unavailable (JSON array)
# AI_FALLBACK_MODELS='["gpt-4o","gpt-4o-mini","claude-sonnet-4"]'

# Static model list for when DB is unavailable (JSON array of objects)
# AI_STATIC_MODEL_LIST='[{"id":"gpt-4.1","name":"GPT-4.1","provider":"GitHub","capabilities":["chat","vision"]}]'

# Async Mode: Route AI requests through Redis Streams
AI_ASYNC_MODE=false

# -----------------------------------------------------------------------------
# AI Temperatures (0.0-1.0)
# -----------------------------------------------------------------------------
# AI_TEMP_DEFAULT=0.7    # General operations
# AI_TEMP_SKETCH=0.3     # Concept sketches
# AI_TEMP_PRISM=0.2      # Multi-angle analysis
# AI_TEMP_CHAIN=0.2      # Chain of thought
# AI_TEMP_SUMMARY=0.2    # Summarization
# AI_TEMP_GENERATE=0.2   # Text generation

# -----------------------------------------------------------------------------
# Agent Configuration
# -----------------------------------------------------------------------------
# AGENT_MAX_TOOL_ITERATIONS=10       # Max tool calls per request
# AGENT_MAX_CONTEXT_MESSAGES=20      # Max messages in context window
# AGENT_MEMORY_MIN_SCORE=0.7         # Min relevance for memory retrieval
# AGENT_MEMORY_LIMIT=5               # Max memories to retrieve
# AGENT_STREAM_CHUNK_SIZE=40         # Streaming chunk size (chars)
# AGENT_STREAM_CHUNK_DELAY_MS=15     # Delay between chunks (ms)

# -----------------------------------------------------------------------------
# Text Processing Limits
# -----------------------------------------------------------------------------
# TEXT_LIMIT_TASK_PARAGRAPH=1600    # Max paragraph length for AI tasks
# TEXT_LIMIT_TASK_TITLE=120         # Max title length for AI tasks
# TEXT_LIMIT_FALLBACK=200           # Fallback text limit
# TEXT_LIMIT_BULLET=140             # Bullet point text limit
# TEXT_LIMIT_WEB_PAGE=5000          # Max web page content length
# TEXT_LIMIT_MEMORY=500             # Max conversation content to save

# -----------------------------------------------------------------------------
# RAG Embeddings (OpenAI-Compatible)
# -----------------------------------------------------------------------------
# Optional embedding-specific endpoint/key (falls back to AI_SERVER_URL + AI_API_KEY)
AI_EMBEDDING_URL=https://api.openai.com/v1
AI_EMBEDDING_API_KEY=
AI_EMBED_MODEL=text-embedding-3-small

# ChromaDB Vector Database
CHROMA_URL=http://chromadb:8000
CHROMA_COLLECTION=blog-posts__all-MiniLM-L6-v2

# -----------------------------------------------------------------------------
# Search Configuration
# -----------------------------------------------------------------------------
# SEARCH_DEFAULT_LIMIT=5           # Default number of search results
# SEARCH_DEFAULT_ENGINE=tavily     # Default search engine
# TAVILY_SEARCH_DEPTH=advanced     # basic or advanced
# PERPLEXITY_RECENCY_FILTER=month  # day, week, month, year
# RAG_DEFAULT_RESULTS=5            # Default RAG result count
# RAG_MIN_SCORE=0.5                # Minimum RAG relevance score

# -----------------------------------------------------------------------------
# AI Search Provider API Keys
# -----------------------------------------------------------------------------
# Perplexity AI Search (AI-powered search with citations)
# Get API key from: https://www.perplexity.ai/settings/api
PERPLEXITY_API_KEY=

# Tavily Search (AI-optimized search engine)
# Get API key from: https://tavily.com/
TAVILY_API_KEY=

# Brave Search (optional)
# Get API key from: https://brave.com/search/api/
BRAVE_SEARCH_API_KEY=

# Serper (Google search, optional)
# Get API key from: https://serper.dev/
SERPER_API_KEY=

# -----------------------------------------------------------------------------
# AI API Endpoints (optional overrides)
# -----------------------------------------------------------------------------
# SEARCH_API_URL=https://api.duckduckgo.com/
# PERPLEXITY_API_URL=https://api.perplexity.ai/chat/completions
# TAVILY_API_URL=https://api.tavily.com/search
# BRAVE_SEARCH_URL=https://api.search.brave.com/res/v1/web/search
# SERPER_URL=https://google.serper.dev/search

# -----------------------------------------------------------------------------
# Image Processing
# -----------------------------------------------------------------------------
# IMAGE_MAX_SIZE_BYTES=10485760    # 10MB max upload size
# IMAGE_DEFAULT_MIME=image/jpeg
# WEB_SCRAPER_USER_AGENT=Mozilla/5.0 (compatible; BlogAgent/1.0)

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
JWT_EXPIRES_IN=12h
JWT_SECRET=

# -----------------------------------------------------------------------------
# GitHub Integration (Admin PR creation)
# -----------------------------------------------------------------------------
GITHUB_TOKEN=
GITHUB_REPO_OWNER=choisimo
GITHUB_REPO_NAME=blog
GIT_USER_NAME=CI Bot
GIT_USER_EMAIL=ci@example.com

# -----------------------------------------------------------------------------
# Admin Authentication
# -----------------------------------------------------------------------------
ADMIN_BEARER_TOKEN=
ADMIN_USERNAME=
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# Content Paths (Docker deployment)
# -----------------------------------------------------------------------------
# CONTENT_PUBLIC_DIR=/frontend/public
# CONTENT_POSTS_DIR=/frontend/public/posts
# CONTENT_IMAGES_DIR=/frontend/public/images
POSTS_SOURCE=filesystem

# -----------------------------------------------------------------------------
# Service URLs (internal)
# -----------------------------------------------------------------------------
# INTERNAL_API_URL=http://localhost:5080
TERMINAL_SERVER_URL=http://terminal-server:8080
TERMINAL_GATEWAY_URL=https://terminal.nodove.com

# -----------------------------------------------------------------------------
# RAG Prompts (optional customization)
# -----------------------------------------------------------------------------
# RAG_BLOG_ASSISTANT_PROMPT=당신은 nodove 블로그의 AI 어시스턴트입니다.
# RAG_CONTEXT_TEMPLATE=아래는 사용자의 질문과 관련된 블로그 게시글 목록입니다.
# RAG_RECOMMENDATION_INSTRUCTION=위 게시글들을 참고하여 사용자에게 적절한 게시글을 추천해주세요.

# Vision Analysis Prompt
# VISION_DEFAULT_PROMPT=이 이미지를 분석해주세요...

# RAG Keywords (JSON arrays for trigger detection)
# RAG_KEYWORDS_KOREAN='["게시글","포스트","글","추천","관련"]'
# RAG_KEYWORDS_ENGLISH='["post","blog","article","recommend","find"]'

# -----------------------------------------------------------------------------
# MinIO Object Storage (Optional)
# -----------------------------------------------------------------------------
MINIO_USER=minioadmin
MINIO_PASSWORD=

# -----------------------------------------------------------------------------
# Firecrawl Web Scraper (Optional)
# -----------------------------------------------------------------------------
FIRECRAWL_API_TOKEN=

# -----------------------------------------------------------------------------
# Terminal Server
# -----------------------------------------------------------------------------
SANDBOX_IMAGE=alpine:latest

# -----------------------------------------------------------------------------
# Monitoring (Optional - enable with --profile monitoring)
# -----------------------------------------------------------------------------
GRAFANA_PASSWORD=

# -----------------------------------------------------------------------------
# Admin Tools (Optional - enable with --profile admin)
# -----------------------------------------------------------------------------
PGADMIN_EMAIL=admin@example.com
PGADMIN_PASSWORD=
