#:schema node_modules/wrangler/config-schema.json
name = "blog-api"
main = "src/index.ts"
compatibility_date = "2024-09-01"
compatibility_flags = ["nodejs_compat"]
account_id = "f6f11e2a4e5178d2f37476785018f761"

# Secrets (set via wrangler secret put):
#
# === Required for Authentication ===
# - JWT_SECRET: Secret key for JWT token signing (required)
# - ADMIN_USERNAME: Admin username for login (required)
# - ADMIN_PASSWORD: Admin password (required)
# - ADMIN_EMAIL: Admin email for OTP verification (required)
#
# === Required for Email OTP ===
# - RESEND_API_KEY: Resend.com API key for sending OTP emails
# - NOTIFY_FROM_EMAIL: Email sender address (e.g., "noreply@yourdomain.com")
#
# === AI Features (Optional) ===
# - GEMINI_API_KEY: Google Gemini API key for AI features
# - OPENROUTER_API_KEY: OpenRouter API key for vision fallback
# - AI_SERVE_API_KEY: Internal API key for self-hosted AI server
#
# Set secrets with: npx wrangler secret put <SECRET_NAME> [--env production]
#
# GitHub Actions: Add these as repository secrets, then deploy workflow
# will automatically set them via wrangler secret put

# Development environment variables
[vars]
ENV = "development"
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:4173,http://localhost:8080,http://localhost:8081,https://noblog.nodove.com,https://blog.nodove.com,https://blog-test.nodove.com"
ASSETS_BASE_URL = "https://assets-b.nodove.com"
# Backend API via Cloudflare Tunnel
API_BASE_URL = "https://api.nodove.com"
# AI Agent Configuration for gateway routes
# Mode: 'backend' (self-hosted), 'external' (direct API), 'auto' (backend first with fallback)
# These can be overridden at runtime via KV: config:ai_agent_mode, config:ai_agent_backend_url
# AI_AGENT_MODE = "backend"
# AI_AGENT_BACKEND_URL = "https://api.nodove.com"

# D1 Database binding (development)
[[d1_databases]]
binding = "DB"
database_name = "blog-db"
database_id = "65661464-f6e2-4cdf-8da8-dd63a482fd29"

# R2 Storage binding (development)
# [[r2_buckets]]
# binding = "R2"
# bucket_name = "blog-assets-dev"
# preview_bucket_name = "blog-assets-dev"

[[r2_buckets]]
binding = "R2"
bucket_name = "blog"

# KV namespace binding (development)
[[kv_namespaces]]
binding = "KV"
id = "8bb28b36c3cb42da8ed7aca89f8cf0fe"

# Cron triggers for scheduled tasks (daily at 6 AM UTC)
[triggers]
crons = ["0 6 * * *"]

# Production environment
[env.production]
name = "blog-api-prod"

[env.production.vars]
ENV = "production"
ALLOWED_ORIGINS = "https://noblog.nodove.com,https://blog.nodove.com,https://blog-test.nodove.com"
# Backend API via Cloudflare Tunnel
API_BASE_URL = "https://api.nodove.com"

[[env.production.d1_databases]]
binding = "DB"
database_name = "blog-db-prod"
database_id = "e547f944-71a0-42b6-8af1-abc50f29df80"

# [[env.production.r2_buckets]]
# binding = "R2"
# bucket_name = "blog-assets-prod"

[[env.production.r2_buckets]]
binding = "R2"
bucket_name = "blog"

[[env.production.kv_namespaces]]
binding = "KV"
id = "3d45140577d94404bc5f4bf000b07488"

# Observability (optional)
[observability]
enabled = true
