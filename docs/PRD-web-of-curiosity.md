# PRD: Web of Curiosity 기능 고도화 및 시각화 개선

본 문서는 사용자의 지적 호기심 경로를 추적·시각화하는 Web of Curiosity 기능의 문제를 해결하고, 실제로 유용한 인사이트를 제공하는 제품으로 발전시키기 위한 요구사항과 구현 계획을 정의합니다.

---

## 1) 개요 및 문제 정의

- 문제 배경: 현재 기능은 사용자의 블로그 내 탐색·학습 경로를 되돌아보게 하는 것을 목표로 하나, 데이터의 의미·시각화·핵심 기능 모두 미흡합니다.
- 핵심 문제점
  1) 무의미한 데이터 수집: 패널 열고 닫기 등 UI 상호작용 중심으로 기록되어 실제 관심사 추적에 도움이 되지 않음.
  2) 비효율적 시각화: 시간 순서로 수평 나열되어 노드 관계를 파악하기 어렵고 스케일에 취약함.
  3) 핵심 컨텍스트 부재: 게시글 방문, 특정 위치의 메모, 태그 클릭, 검색 실행 등 가치 있는 이벤트가 추적되지 않음.

---

## 2) 목표 (Objectives)

- 데이터 품질 향상 (P0): 의미 있는 행동만 선별 수집. 불필요한 UI 이벤트 제외.
- 시각화 직관성 강화 (P0): 선형에서 네트워크형(Force-Directed)으로 전환하여 관계·군집을 직관적으로 표현.
- 기능적 가치 증대 (P1): 게시글·메모·태그·검색 등 핵심 컨텍스트 노드 추가로 복기·인사이트 창출.
- 접근성/성능 (P1): 대량 노드에서도 상호작용 가능한 FPS, 키보드 내비게이션·명확 대비·포커스링 제공.

---

## 3) 사용자 시나리오 (User Stories)

- 독자: 지난 2주간 내가 어떤 주제/태그를 따라가며 무엇을 읽고 메모했는지 한눈에 보고 싶다.
- 작성자: 독자의 탐색 패턴에서 인기 주제/연결을 파악하고 다음 콘텐츠 아이디어를 얻고 싶다.
- 연구자형 사용자: 특정 문제(예: 알고리즘) 학습 과정에서 어떤 포스트들을 순회·재방문했고 어떤 메모를 남겼는지 흐름을 복기하고 싶다.

---

## 4) 범위 (Scope)

- 포함: 프런트엔드 이벤트 수집/로컬 저장, 그래프 시각화 UI, 필터·검색, 내보내기(이미지/JSON), 기본 프라이버시 설정.
- 제외(비범위): 서버 사이드 사용자별 장기 저장·동기화(후속 단계), 계정별 협업 뷰, 추천 알고리즘.

---

## 5) 기능 요구사항 (Functional Requirements)

### FR-1: 이벤트 트래킹 시스템 개선 (P0)
- FR-1.1 추적 대상 이벤트(노드 생성 트리거)
  - 게시글 방문: BlogPost 진입 시 `{type: 'post_view', postId, path, title, tags, ts}`
  - 메모 작성: 특정 포스트/선택범위에서 `{type: 'memo_create', postId, selectionHash, snippet, ts}`
  - 태그 클릭: `{type: 'tag_click', tag, fromPostId?, ts}`
  - 카테고리 선택: `{type: 'category_filter', category, ts}`
  - 검색 실행: `{type: 'search', queryHash, queryText?, ts}` (원문은 기본 비저장, 해시 우선)
- FR-1.2 이벤트 필터링(제외)
  - 패널 열기/닫기, 스크롤, 비컨텐츠 단순 클릭 등 의미 없는 UI 이벤트 제외.
- FR-1.3 이벤트 저장/용량
  - 기본 로컬 우선: `localStorage('curiosity.events')` 또는 IndexedDB(`curiosity-db`) 선택 저장(환경 특성 고려).
  - 최대 이벤트 수: 기본 1,500개(최신 우선 보존, 오래된 항목 드롭). 설정에서 500~5000 범위 조정.
- FR-1.4 개인 정보/보안
  - 민감 데이터 비수집 원칙. 검색어는 해시 보관을 기본값, 원문 저장은 옵트인 토글.
  - 도메인 외부 링크/페이지는 기본 비수집.

### FR-2: 그래프 시각화 알고리즘 변경 (P0)
- FR-2.1 Force-Directed 레이아웃(D3-Force)
  - 링크 기반 인과관계/동시 컨텍스트에 따라 물리 시뮬레이션 적용.
  - 노드 충돌 방지, 군집화(태그/카테고리 기반), 중력·전하 파라미터 노출.
- FR-2.2 노드 시각적 구분
  - 타입별 색상/아이콘: post, memo, tag, category, search.
  - 강조: 최근 N분 내 생성, 재방문 수 상위, 북마크 표시 등.
- FR-2.3 인터랙션
  - Hover 툴팁: 제목/태그/메모 일부·타임스탬프.
  - Click: 포스트 이동, 메모 전체 보기, 태그 필터 적용.
  - 드래그 고정/해제, 확대/이동(Zoom/Pan), 미니맵.
- FR-2.4 접근성
  - 키보드 포커스 가능한 노드/컨트롤, 스크린리더 레이블, 색각보정 팔레트.

### FR-3: 노드 간 연결(Edge) 로직 (P1)
- FR-3.1 컨텍스트 기반 연결
  - post_view → memo_create(같은 postId): post—memo 에지.
  - post_view → tag_click(해당 포스트의 태그): post—tag 에지.
  - search → post_view(검색 결과로 유입 추정 시): search—post 에지.
  - tag_click → post_view(태그 목록에서 유입 추정 시): tag—post 에지.
- FR-3.2 시각적 피드백
  - 방향성/강도 표현(얇기/투명도/애니메이션), 최근 경로 하이라이트, 재생(Timeline scrub).

### FR-4: 필터링·탐색 UI (P1)
- 시간 범위 슬라이더(최근 1일/7일/30일/전체), 타입 토글, 태그 검색, 최소 연결도(차수) 필터.
- 프리셋: “학습 흐름만(포스트+메모)”, “태그 중심 뷰”, “검색에서 시작된 경로”.

### FR-5: 데이터 내보내기/관리 (P1)
- PNG/SVG로 그래프 스냅샷 다운로드, JSON 내보내기/가져오기.
- 데이터 비우기(Reset) 및 백업/복원.

### FR-6: 설정/프라이버시 (P0)
- 옵트인/옵트아웃 토글, 검색 원문 저장 여부, 최대 저장 용량, 데이터 유지기간(기본 90일).
- 간단한 투명성 뷰: 최근 20개 이벤트 원본 미리보기.

---

## 6) 비기능 요구사항 (Non-Functional)

- 성능: 500~1,000 노드/에지에서 상호작용 FPS 30 이상(데스크톱 기준). 모바일 200 노드 내 권장.
- 안정성: 저장 중단/복구 시 손상 방지(배치 커밋, 스키마 버전).
- 보안/프라이버시: 민감정보 비수집, 옵트인 정책 기본, 데이터 삭제/내보내기 투명성.
- 확장성: 후속 서버 동기화/다기기 동기화와 호환되는 이벤트 스키마.

---

## 7) 기술 설계 개요 (Technical Design)

- 이벤트 스키마(예시 JSON)
```json
{
  "id": "evt_1712345678901_abc",
  "type": "post_view | memo_create | tag_click | category_filter | search",
  "ts": 1712345678901,
  "context": {
    "postId": "2025/react-nextjs-modern-web-development",
    "path": "/blog/2025/react-nextjs-modern-web-development",
    "title": "React/Next.js 현대 웹 개발",
    "tags": ["react", "nextjs"],
    "selectionHash": "sha1:...",
    "snippet": "선택된 텍스트 일부 ...",
    "tag": "react",
    "category": "algorithm",
    "queryHash": "sha1:..."
  },
  "meta": {
    "version": 1,
    "ua": "agent-summary-or-omitted",
    "ref": "inferred:search|tag|direct"
  }
}
```

- 저장소 선택
  - 기본: IndexedDB(`curiosity-db.events`) + 메모리 캐시. Fallback: localStorage(`curiosity.events`).
  - 회전 정책: 최대 N개 유지, 오래된 항목 드롭.

- 시각화 스택
  - D3-Force 또는 vis-network. React 래퍼 구성, 캔버스/웹GL 선택적 전환(노드 수에 따라).
  - 레이아웃 파라미터: linkDistance, charge, collision radius, center force를 설정 패널로 노출.

- 에지 생성 규칙
  - 직전 의미 이벤트 간의 인과 에지 + 같은 postId·같은 태그 컨텍스트 에지.
  - 세션 경계(탭/시간) 고려하여 약한 연결로 표기.

- 통합 지점(기존 코드와의 연결)
  - VisitedPostsMinimap/History와 충돌 방지: FAB/오버레이 상태 고려(완료됨).
  - FloatingActionBar 이벤트 브리지: `window.dispatchEvent(new CustomEvent('fab:event', ...))`를 통한 추후 연계 포인트.
  - 기존 `localStorage('aiMemo.events')`는 분리 유지. 새 스키마는 `curiosity.events`/IndexedDB 사용.

---

## 8) UX 흐름 & 와이어프레임(개략)

- 진입: FAB의 History → “Web of Curiosity” 열기.
- 상단 바: 기간 필터, 타입 토글, 검색, 내보내기, 설정 아이콘.
- 메인 캔버스: 네트워크 그래프(미니맵 오른쪽 하단), 툴팁/클릭 액션.
- 하단 타임라인: 재생/일시정지, 스크러브로 경로 재현.

---

## 9) 롤아웃·플래그 (Rollout)

- 기능 플래그: `VITE_FEATURE_CURIOSITY_WEB` + `localStorage('curiosity.web.enabled')`로 제어.
- 단계적 공개: 내부/베타(10%) → 전체. 오류/성능 수집(옵트인)과 핫픽스 경로 확보.

---

## 10) 성공 지표 (Success Metrics)

- 정량
  - UI 상호작용(비의미) 이벤트 생성률 0%.
  - 핵심 노드(포스트/메모/태그/검색) 비중 ≥ 95%.
  - 노드당 평균 연결수 ≥ 1.5 (선형 탈피 지표).
  - 평균 그래프 체류시간/인터랙션(줌/클릭/필터) 증가.
- 정성
  - 사용자 테스트에서 “관심사 흐름 파악에 도움” 응답 ≥ 80%.

---

## 11) 마일스톤 (Milestones)

- Phase 1 (P0, 1~2주)
  - 이벤트 트래커 리팩터링(포스트/태그/검색/메모 생성 후킹)
  - IndexedDB 저장/회전 정책, 내보내기(JSON)
  - 네트워크 레이아웃 MVP + 기본 툴팁/클릭
  - 설정(프라이버시·용량·옵트인)
- Phase 2 (P1, 2~3주)
  - 컨텍스트 에지 규칙·타임라인 재현
  - 필터링·프리셋·미니맵·스냅샷(PNG/SVG)
  - 접근성·성능 최적화(가상화/LOD)

---

## 12) 수용 기준 (Acceptance Criteria)

- 의미 이벤트만 저장되고 UI 이벤트는 기록되지 않는다(유닛·E2E 확인).
- 500 노드·800 에지에서 데스크톱 상호작용 FPS 30+ 유지.
- 타입별 색상/아이콘·툴팁·클릭 내비게이션 작동.
- 기간/타입/태그 필터가 즉시 반영되고, 내보내기(JSON/PNG)가 동작.
- 옵트아웃 시 신규 수집 중단·데이터 삭제 기능 제공.

---

## 13) 리스크 & 완화

- 성능 병목: 대규모 노드 시 WebGL 고려, LOD/클러스터링 도입.
- 프라이버시: 검색 원문 저장은 옵트인, 해시 기본. 도메인 외부는 차단.
- 정확한 인과 추정: referrer/직전 이벤트 기반 휴리스틱 → 설정에서 사용자 제어/수정 지원.

---

## 14) 오픈 이슈

- 서버 동기화/멀티 디바이스 지원 필요 시점과 저장소 설계.
- 추천 기능(그래프 기반 탐색 가이드)의 범위·시기.
- 편집 가능한 노드 메모(후속), 협업(공유) 여부.
