sequenceDiagram
    participant User as User
    participant FE as Frontend
    participant GW as Workers Gateway
    participant BE as Backend API
    participant SVC as AI Service
    participant OC as OpenCode Client
    participant RAG as RAG Service
    participant LLM as LLM Provider

    User->>FE: 메시지 입력
    FE->>FE: 요청 객체 생성
    Note right of FE: { message, sessionId, options }
    
    FE->>GW: POST /ai/auto-chat
    GW->>GW: 인증 검증 (JWT)
    GW->>BE: 요청 전달 (프록시)
    
    BE->>SVC: handleAutoChat(request)
    SVC->>RAG: searchContext(message)
    RAG-->>SVC: 관련 컨텍스트 반환
    
    SVC->>SVC: 프롬프트 구성
    Note right of SVC: System prompt + Context + User message
    
    SVC->>OC: chat({ messages, options })
    OC->>LLM: API 호출
    
    alt Streaming 모드
        LLM-->>OC: SSE 청크 스트림
        OC-->>SVC: 청크 전달
        SVC-->>BE: 청크 전달
        BE-->>GW: SSE 스트림
        GW-->>FE: SSE 스트림
        FE->>FE: 점진적 렌더링
    else Non-Streaming 모드
        LLM-->>OC: 완전한 응답
        OC-->>SVC: 응답 반환
        SVC-->>BE: 응답 반환
        BE-->>GW: JSON 응답
        GW-->>FE: JSON 응답
    end
    
    FE->>User: 응답 표시
