sequenceDiagram
    participant User as User
    participant FE as Frontend
    participant GW as Workers Gateway
    participant BE as Backend API
    participant SVC as AI Service
    participant OC as OpenCode Client
    participant LLM as Vision LLM

    User->>FE: 이미지 업로드
    FE->>FE: 이미지 처리
    Note right of FE: Base64 인코딩 또는 URL 추출
    
    FE->>GW: POST /ai/vision/analyze
    Note right of FE: { imageUrl/imageBase64, prompt }
    
    GW->>BE: 요청 전달
    BE->>SVC: handleVisionAnalyze(request)
    
    SVC->>SVC: 이미지 검증
    Note right of SVC: 크기, 포맷, 지원 여부 확인
    
    SVC->>SVC: Vision 프롬프트 구성
    Note right of SVC: 분석 타입별 시스템 프롬프트
    
    SVC->>OC: vision({ image, prompt })
    OC->>OC: Provider 어댑터 선택
    Note right of OC: Vision 지원 Provider 확인
    
    OC->>LLM: Vision API 호출
    LLM-->>OC: 분석 결과
    
    OC-->>SVC: 정규화된 결과
    SVC->>SVC: 후처리
    Note right of SVC: JSON 파싱, 구조화
    
    SVC-->>BE: VisionResponse
    BE-->>GW: JSON 응답
    GW-->>FE: JSON 응답
    FE->>User: 분석 결과 표시
